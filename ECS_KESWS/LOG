DROP TRIGGER IF EXISTS CONSIGNEMENTSTATUSLOG_AFTER_INSERT_UPDATE_INBOX_LOGS;
DELIMITER $$
CREATE TRIGGER CONSIGNEMENTSTATUSLOG_AFTER_INSERT_UPDATE_INBOX_LOGS BEFORE INSERT ON CONSIGNEMENTSTATUSLOG
FOR EACH ROW
  BEGIN
DECLARE NEWSTATUS varchar(50);
SELECT NEW.STATUS INTO NEWSTATUS;
    IF  EXISTS (SELECT CONSIGNEMENT_ID_Ref FROM `kephisecslatestv1-1`.INBOX_LOGS WHERE INBOX_LOGS.CONSIGNEMENT_ID_Ref=NEW.CGT_ID) THEN
       IF (NEWSTATUS='SUBMITTED') THEN
           UPDATE `kephisecslatestv1-1`.`INBOX_LOGS` AS `INBOX_LOGS`   SET  `INBOX_LOGS`.`Date_Time_Submitted_To_ECS`=NOW() WHERE `INBOX_LOGS`.`CONSIGNEMENT_ID_Ref`= NEW.CGT_ID;
		 -- INSERT INTO `kephisecslatestv1-1`.log SELECT now(), concat('debug comment SUBMITTED', NEW.CGT_ID);
END IF;
       IF (NEWSTATUS='PLANNED') THEN
           UPDATE `kephisecslatestv1-1`.`INBOX_LOGS` AS `INBOX_LOGS`   SET  `INBOX_LOGS`.`Date_Time_Planned`=NOW() WHERE `INBOX_LOGS`.`CONSIGNEMENT_ID_Ref`= NEW.CGT_ID;
		-- INSERT INTO `kephisecslatestv1-1`.log SELECT now(), concat('debug comment PLANNED', NEW.CGT_ID);
END IF; 
       IF (NEWSTATUS='REJECTED') THEN
           UPDATE `kephisecslatestv1-1`.`INBOX_LOGS` AS `INBOX_LOGS`   SET  `INBOX_LOGS`.`InspectionStatus`='REJECTED', `INBOX_LOGS`.`Date_Time_Inspected`=NOW() WHERE `INBOX_LOGS`.`CONSIGNEMENT_ID_Ref`= NEW.CGT_ID;
		-- INSERT INTO `kephisecslatestv1-1`.log SELECT now(), concat('debug comment REJECTED', NEW.CGT_ID);
END IF;
	   IF (NEWSTATUS='PASSED') THEN
           UPDATE `kephisecslatestv1-1`.`INBOX_LOGS` AS `INBOX_LOGS`   SET  `INBOX_LOGS`.`InspectionStatus`='PASSED', `INBOX_LOGS`.`Date_Time_Inspected`=NOW() WHERE `INBOX_LOGS`.`CONSIGNEMENT_ID_Ref`= NEW.CGT_ID;
		   INSERT INTO `kephisecslatestv1-1`.log SELECT now(), concat('debug comment PASSED', NEW.CGT_ID);
END IF;
 IF (NEWSTATUS='ISSUED') THEN
           UPDATE `kephisecslatestv1-1`.`INBOX_LOGS` AS `INBOX_LOGS`   SET   `INBOX_LOGS`.`InspectionStatus`='PASSED', `INBOX_LOGS`.`Date_Time_Cert_Issued`=NOW() WHERE `INBOX_LOGS`.`CONSIGNEMENT_ID_Ref`= NEW.CGT_ID;
		-- INSERT INTO `kephisecslatestv1-1`.log SELECT now(), concat('debug comment PASSED', NEW.CGT_ID);
END IF;
	END IF;
  END $$
DELIMITER ;